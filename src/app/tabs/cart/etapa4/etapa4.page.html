<ion-header>
  <ion-toolbar class="etapa4-header">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back-outline" class="etapa4-back-icon"></ion-icon>
      </ion-button>
    </ion-buttons>
    <div class="etapa4-logo">
      <div class="etapa4-logo-circle">NT</div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="etapa4-content">
  <!-- 4 Passos com o 4 ativo -->
  <div class="etapa4-steps">
    <div class="etapa4-step">1</div>
    <div class="etapa4-step">2</div>
    <div class="etapa4-step">3</div>
    <div class="etapa4-step active">4</div>
  </div>

  <!-- Linha verde de borda a borda -->
  <div class="etapa4-divider"></div>

  <!-- Título -->
  <h2 class="etapa4-title">Confirmação</h2>

  <!-- Card do produto com imagem -->
  <div class="etapa4-product-card">
    <div class="etapa4-product-info">
      <img 
        [src]="produto.image || 'assets/images/nokia-3110.png'" 
        [alt]="produto.name"
        class="etapa4-product-image"
        (error)="produto.image = 'assets/images/placeholder.png'" />
      <div class="etapa4-product-details">
        <h3 class="etapa4-product-name">{{ produto.name }}</h3>
        <p class="etapa4-product-price">€{{ total | number:'1.2-2' }}</p>
      </div>
    </div>
  </div>

  <!-- Resumo expansível -->
  <div class="etapa4-summary">
    <!-- Local da Entrega -->
    <div class="etapa4-summary-item" [class.expanded]="showDeliveryDetails" (click)="toggleDelivery()">
      <span class="etapa4-summary-label">Local da Entrega</span>
      <div class="etapa4-summary-value">
        <span>{{ localEntrega }}</span>
        <ion-icon 
          [name]="showDeliveryDetails ? 'chevron-up-outline' : 'chevron-down-outline'" 
          class="etapa4-summary-arrow">
        </ion-icon>
      </div>
    </div>
    
    <!-- Detalhes do Local da Entrega -->
    <div class="etapa4-details" [class.expanded]="showDeliveryDetails">
      <div class="etapa4-details-content">
        <p><strong>Morada:</strong></p>
        <p>{{ morada.rua }}<br>{{ morada.codigoPostal }}<br>{{ morada.pais }}</p>
      </div>
    </div>

    <!-- Método de Pagamento -->
    <div class="etapa4-summary-item" [class.expanded]="showPaymentDetails" (click)="togglePayment()">
      <span class="etapa4-summary-label">Método de Pagamento</span>
      <div class="etapa4-summary-value">
        <span>{{ metodoPagamento }}</span>
        <ion-icon 
          [name]="showPaymentDetails ? 'chevron-up-outline' : 'chevron-down-outline'" 
          class="etapa4-summary-arrow">
        </ion-icon>
      </div>
    </div>

    <!-- Detalhes do Método de Pagamento -->
    <div class="etapa4-details" [class.expanded]="showPaymentDetails">
      <div class="etapa4-details-content">
        <p><strong>Dados do Cartão:</strong></p>
        <p>Titular: {{ cartao.nomeTitular }}<br>
        Cartão: **** **** **** {{ cartao.numeroCartao?.slice(-4) }}<br>
        Validade: {{ cartao.validade }}</p>
      </div>
    </div>
  </div>
</ion-content>

<!-- Barra fixa com preço correto -->
<div class="etapa4-footer-bar">
  <div class="etapa4-footer-total">
    €{{ total | number:'1.2-2' }}
  </div>
  <ion-button expand="block" class="etapa4-footer-btn" (click)="concluir()">
    Concluir
  </ion-button>
</div>
